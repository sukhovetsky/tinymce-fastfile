(function(){function b(f){var h=null;if(tinymce["majorVersion"]!="4"||!f["inline"]){h=f["getContainer"]()}else {h=window["document"]["getElementById"](f["theme"]["panel"]._id)};if(h==null){return null};var g=h["getElementsByClassName"]("mce-mce_button_fastfile");if(g["length"]>0){var e=g[0]["getElementsByTagName"]("I");if(e["length"]>0){return e[0]}else {return null};}else {return null};}function d(e){var f=b(e);if(f!=null){f["style"]["backgroundImage"]=f["style"]["backgroundImage"]["replace"](/fastfile\.png/,"progress.gif")};}function a(e){var f=b(e);if(f!=null){f["style"]["backgroundImage"]=f["style"]["backgroundImage"]["replace"](/progress\.gif/,"fastfile.png")};}function c(f,e,j,i,h){var g;if(window["XMLHttpRequest"]){g= new XMLHttpRequest()}else {g= new ActiveXObject("Microsoft.XMLHTTP")};g["onreadystatechange"]=(function(){var k=f;return function(){if(g["readyState"]==4){if(g["status"]==200){i(f,g["responseText"])}else {h(f,g["responseText"])}}};})();g["open"]("POST",e,true);g["setRequestHeader"]("X-CSRFToken",$["cookie"]("csrftoken"));g["send"](j);}tinymce["PluginManager"]["add"]("fastfile",function(f,e){f["on"]("drop",function(c){c["preventDefault"]();var fn=c["dataTransfer"]["files"][0]["name"];var t=c["dataTransfer"]["files"][0]["type"];function pasteImage(reader){var formData= new FormData();var blob= new Blob([reader["result"]],{"type":t});formData["append"]("file_0",blob,fn);$["ajax"]({url:"/message_files/",type:"POST",data:formData,processData:false,contentType:false,success:function(data){f["insertContent"](data)}});}reader= new FileReader();reader["onload"]=pasteImage["bind"](null,reader);reader["readAsArrayBuffer"](c["dataTransfer"]["files"][0]);});var g=function(i){var j=document["getElementById"]("fastfileForm");if(j!=null){j["parentNode"]["removeChild"](j)};j=document["createElement"]("div");j["id"]="fastfileForm";j["setAttribute"]("style","display:none");j["innerHTML"]="<form enctype=\"multipart/form-data\"><input type=\"file\" name=\"files\" multiple=\"multiple\" id=\"fastfileFile\"><input type=\"submit\" id=\"fastfileSubmit\"></form>";document["getElementsByTagName"]("body")[0]["appendChild"](j);var h=document["getElementById"]("fastfileFile");h["addEventListener"]("change",(function(){var k=h;var m=i;var l=i["getParam"]("fastfile_url","/message_files/");return function(){var o=k["files"];var p= new FormData();for(var n=0;n<o["length"];n++){p["append"]("file_"+n,o[n])};d(m);c(m,l,p,function(r,q){a(r);if(tinymce["majorVersion"]=="4"){r["insertContent"](q)}else {r["execCommand"]("mceInsertContent",false,q)};},function(r,q){a(r);alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438: "+q);});};})());h["click"]();};var u=tinymce["baseURL"]["split"]("/");u["pop"]();u=u["join"]("/");f["addButton"]("fastfile",{type:"button",icon:true,image:u+"/tinymce-fastfile/fastfile.png",classes:"widget btn mce_button_fastfile",tooltip:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0444\u0430\u0439\u043b",title:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0444\u0430\u0439\u043b",onclick:(function(){var h=f;return function(){g(h)};})()});if(tinymce["majorVersion"]=="4"){f["addMenuItem"]("fastfile",{text:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0444\u0430\u0439\u043b",context:"insert",icon:true,image:u+"/tinymce-fastfile/fastfile.png",onclick:(function(){var h=f;return function(){g(h)};})()})};});})();(function(){function b(f){var h=null;if(tinymce["majorVersion"]!="4"||!f["inline"]){h=f["getContainer"]()}else {h=window["document"]["getElementById"](f["theme"]["panel"]._id)};if(h==null){return null};var g=h["getElementsByClassName"]("mce-mce_button_fastimage");if(g["length"]>0){var e=g[0]["getElementsByTagName"]("I");if(e["length"]>0){return e[0]}else {return null};}else {return null};}function d(e){var f=b(e);if(f!=null){f["style"]["backgroundImage"]=f["style"]["backgroundImage"]["replace"](/fastimage\.png/,"progress.gif")};}function a(e){var f=b(e);if(f!=null){f["style"]["backgroundImage"]=f["style"]["backgroundImage"]["replace"](/progress\.gif/,"fastimage.png")};}function c(f,e,j,i,h){var g;if(window["XMLHttpRequest"]){g= new XMLHttpRequest()}else {g= new ActiveXObject("Microsoft.XMLHTTP")};g["onreadystatechange"]=(function(){var k=f;return function(){if(g["readyState"]==4){if(g["status"]==200){i(f,g["responseText"])}else {h(f,g["responseText"])}}};})();g["open"]("POST",e,true);g["setRequestHeader"]("X-CSRFToken",$["cookie"]("csrftoken"));g["send"](j);}tinymce["PluginManager"]["add"]("fastimage",function(f,e){var g=function(i){var j=document["getElementById"]("fastimageForm");if(j!=null){j["parentNode"]["removeChild"](j)};j=document["createElement"]("div");j["id"]="fastimageForm";j["setAttribute"]("style","display:none");j["innerHTML"]="<form enctype=\"multipart/form-data\"><input type=\"file\" name=\"files\" multiple=\"multiple\" id=\"fastimageFile\"><input type=\"submit\" id=\"fastimageSubmit\"></form>";document["getElementsByTagName"]("body")[0]["appendChild"](j);var h=document["getElementById"]("fastimageFile");h["addEventListener"]("change",(function(){var k=h;var m=i;var l=i["getParam"]("fastimage_url","/message_files/");return function(){var o=k["files"];var p= new FormData();for(var n=0;n<o["length"];n++){p["append"]("file_"+n,o[n])};d(m);c(m,l,p,function(r,q){a(r);if(tinymce["majorVersion"]=="4"){r["insertContent"](q)}else {r["execCommand"]("mceInsertContent",false,q)};},function(r,q){a(r);alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438: "+q);});};})());h["click"]();};var u=tinymce["baseURL"]["split"]("/");u["pop"]();u=u["join"]("/");f["addButton"]("fastimage",{type:"button",icon:true,image:u+"/tinymce-fastfile/fastimage.png",classes:"widget btn mce_button_fastimage",tooltip:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",title:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",onclick:(function(){var h=f;return function(){g(h)};})()});if(tinymce["majorVersion"]=="4"){f["addMenuItem"]("fastimage",{text:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",context:"insert",icon:true,image:u+"/tinymce-fastfile/fastimage.png",onclick:(function(){var h=f;return function(){g(h)};})()})};});})();
