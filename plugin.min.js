(function(){function b(f){var h=null;if(tinymce.majorVersion!="4"||!f.inline){h=f.getContainer();}else{h=window.document.getElementById(f.theme.panel._id);}if(h==null){return null;}var g=h.getElementsByClassName("mce-mce_button_fastfile");if(g.length>0){var e=g[0].getElementsByTagName("I");if(e.length>0){return e[0];}else{return null;}}else{return null;}}function d(e){var f=b(e);if(f!=null){f.style.backgroundImage=f.style.backgroundImage.replace(/fastfile\.png/,"progress.gif");}}function a(e){var f=b(e);if(f!=null){f.style.backgroundImage=f.style.backgroundImage.replace(/progress\.gif/,"fastfile.png");}}function c(f,e,j,i,h){var g;if(window.XMLHttpRequest){g=new XMLHttpRequest();}else{g=new ActiveXObject("Microsoft.XMLHTTP");}g.onreadystatechange=(function(){var k=f;return function(){if(g.readyState==4){if(g.status==200){i(f,g.responseText);}else{h(f,g.responseText);}}};})();g.open("POST",e,true);g.send(j);}tinymce.PluginManager.add("fastfile",function(f,e){var g=function(i){var j=document.getElementById("fastfileForm");if(j!=null){j.parentNode.removeChild(j);}j=document.createElement("div");j.id="fastfileForm";j.setAttribute("style","display:none");j.innerHTML='<form enctype="multipart/form-data"><input type="file" name="files" multiple="multiple" id="fastfileFile"><input type="submit" id="fastfileSubmit"></form>';document.getElementsByTagName("body")[0].appendChild(j);var h=document.getElementById("fastfileFile");h.addEventListener("change",(function(){var k=h;var m=i;var l=i.getParam("fastfile_url","/message_files/");return function(){var o=k.files;var p=new FormData();for(var n=0;n<o.length;n++){p.append("file_"+n,o[n]);}d(m);c(m,l,p,function(r,q){a(r);if(tinymce.majorVersion=="4"){r.insertContent(q);}else{r.execCommand("mceInsertContent",false,q);}},function(r,q){a(r);alert("Ошибка загрузки: "+q);});};})());h.click();};f.addButton("fastfile",{type:"button",icon:true,image:"/static/base/components/tinymce-fastfile/fastfile.png",classes:"widget btn mce_button_fastfile",tooltip:"Загрузить файл",title:"Загрузить файл",onclick:(function(){var h=f;return function(){g(h);};})()});if(tinymce.majorVersion=="4"){f.addMenuItem("fastfile",{text:"Загрузить файл",context:"insert",icon:true,image:"/static/base/components/tinymce-fastfile/fastfile.png",onclick:(function(){var h=f;return function(){g(h);};})()});}});})();
